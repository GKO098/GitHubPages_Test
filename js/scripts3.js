price_table = {
  "1601": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2505": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2507": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2515": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2691": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "2748": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2752": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2753": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2756": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2771": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2778": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3556": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3723": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3724": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5309": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  // "375001": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3516": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "3519": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "3522": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3548": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1922, 1962, 2141, 2223, 2263, 2572, 2853],
  "3573": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3575": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1922, 1962, 2141, 2223, 2263, 2572, 2853],
  "3655": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "3663": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3682": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "3685": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3688": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "3729": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3794": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "3814": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5004": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5058": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5065": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5094": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5113": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5193": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5246": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5250": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5252": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5253": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5260": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5287": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5297": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5318": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5321": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5334": [1215, 1235, 1255, 1382, 1402, 1422, 1614, 1654, 1911, 1951, 2053, 2245, 2285, 2627, 2941],
  "93672": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  // "525001": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "1114": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "2206": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3551": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "3681": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3683": [1325, 1455, 1475, 1712, 1842, 1862, 2164, 2424, 2791, 3051, 3373, 3675, 3715, 4497, 5251],
  "3695": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "3703": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "3706": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3709": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "3766": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "3775": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "3778": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5019": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5051": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5066": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "5117": [1315, 1445, 1465, 1592, 1722, 1742, 1934, 2084, 2341, 2491, 2703, 2895, 2935, 3387, 3811],
  "5123": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 2055, 2187, 2391],
  "5136": [1425, 1555, 1575, 1812, 1942, 1962, 2374, 2744, 3111, 3481, 3803, 4215, 4345, 4937, 5801],
  "5143": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5145": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "5161": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5178": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5188": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5195": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5222": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "5236": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5248": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5256": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5289": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5290": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "5304": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5327": [1325, 1455, 1475, 1712, 1842, 1862, 2274, 2534, 2901, 3271, 3593, 3895, 3935, 4827, 5581],
  "5339": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5343": [1325, 1455, 1475, 1712, 1842, 1862, 2164, 2424, 2791, 3051, 3373, 3675, 3715, 4497, 5251],
  // "374302": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  // "374313": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "1403": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "1482": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "1602": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "1603": [1525, 1765, 1895, 2242, 2592, 2722, 3354, 3834, 4421, 5011, 5663, 6185, 6335, 7667, 9081],
  "1605": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "1607": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "1609": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "1610": [1402, 1532, 1662, 1899, 2139, 2236, 2648, 3018, 3462, 3832, 4341, 4753, 4793, 5762, 6813],
  "1652": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "2513": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2596": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "2719": [1215, 1235, 1255, 1272, 1402, 1422, 1504, 1544, 1691, 1731, 1943, 2025, 2100, 2297, 2501],
  "2734": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "2736": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "2754": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "2764": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "2774": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "2779": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3505": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3558": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "3567": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "3578": [1402, 1752, 1882, 2229, 2579, 2676, 3308, 3898, 4452, 5042, 5771, 6293, 6553, 7962, 9453],
  "3579": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3612": [1315, 1335, 1355, 1482, 1502, 1522, 1604, 1644, 1791, 1831, 2043, 2125, 2165, 2397, 2601],
  "3624": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3630": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "3698": [1435, 1565, 1695, 1932, 2172, 2302, 2714, 3084, 3561, 3931, 4473, 4885, 4925, 5927, 7011],
  "3780": [1402, 1752, 1882, 2229, 2579, 2676, 3308, 3898, 4452, 5042, 5771, 6293, 6553, 7962, 9453],
  "3785": [1325, 1675, 1805, 2152, 2502, 2522, 3154, 3634, 4221, 4811, 5463, 5985, 6135, 7467, 8881],
  "5013": [1402, 1532, 1552, 1789, 2029, 2126, 2538, 2908, 3352, 3722, 4121, 4423, 4573, 5542, 6483],
  "5015": [1325, 1675, 1805, 2262, 2612, 2632, 3484, 4074, 4771, 5361, 6013, 6755, 6905, 8457, 10091],
  "5042": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5043": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5044": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "5071": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5075": [1402, 1532, 1552, 1789, 2029, 2126, 2538, 2908, 3352, 3722, 4121, 4423, 4573, 5542, 6483],
  "5079": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "5103": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "5106": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5111": [1325, 1675, 1805, 2152, 2502, 2522, 3154, 3234, 4221, 4811, 5463, 5985, 6245, 7577, 8991],
  "5112": [1402, 1532, 1552, 1789, 2029, 2126, 2538, 2908, 3352, 3722, 4121, 4423, 4573, 5542, 6483],
  "5119": [1325, 1675, 1805, 2152, 2502, 2522, 3154, 3234, 4221, 4811, 5463, 5985, 6245, 7577, 8991],
  "5122": [1325, 1675, 1805, 2152, 2502, 2522, 3154, 3234, 4221, 4811, 5463, 5985, 6245, 7577, 8991],
  "5125": [1402, 1752, 1882, 2229, 2579, 2676, 3308, 3898, 4452, 5042, 5771, 6293, 6553, 7962, 9453],
  "5128": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5134": [1402, 1752, 1882, 2229, 2579, 2676, 3308, 3898, 4452, 5042, 5771, 6293, 6553, 7962, 9453],
  "5152": [1402, 1532, 1552, 1789, 2029, 2126, 2538, 2908, 3352, 3722, 4121, 4423, 4573, 5542, 6483],
  "5154": [1535, 1775, 2015, 2472, 2822, 2842, 3694, 4284, 4981, 5681, 6333, 7075, 7225, 8887, 10521],
  "5160": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5186": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "5198": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "5204": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5206": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "5207": [1435, 1565, 1695, 1932, 2172, 2302, 2714, 3084, 3561, 3931, 4473, 4885, 4925, 5927, 7011],
  "5209": [1402, 1532, 1662, 1899, 2139, 2236, 2758, 3128, 3682, 4052, 4561, 4973, 5013, 6092, 7253],
  "5214": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5218": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5237": [1325, 1565, 1695, 2042, 2392, 2412, 2934, 3414, 4001, 4481, 5023, 5545, 5695, 6917, 8221],
  "5243": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5263": [1325, 1565, 1585, 1932, 2282, 2302, 2824, 3194, 3671, 4151, 4583, 5105, 5255, 6367, 7451],
  "5266": [1325, 1455, 1585, 1822, 2062, 2082, 2604, 2974, 3451, 3821, 4253, 4665, 4705, 5707, 6791],
  "5267": [1325, 1565, 1695, 1932, 2172, 2192, 2714, 3084, 3561, 3931, 4363, 4885, 4925, 6037, 7121],
  "5269": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5273": [1325, 1675, 1915, 2372, 2832, 2852, 3594, 4294, 4991, 5691, 6453, 7195, 7455, 9117, 10861],
  "5275": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5277": [1325, 1675, 1805, 2262, 2612, 2632, 3484, 4074, 4771, 5361, 6013, 6755, 6905, 8457, 10091],
  "5283": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "5291": [1315, 1345, 1355, 1372, 1392, 1412, 1494, 1534, 1791, 1831, 1933, 2015, 2055, 2287, 2491],
  "5294": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "5295": [1325, 1455, 1585, 1822, 2062, 2082, 2604, 2974, 3451, 3821, 4253, 4665, 4705, 5707, 6791],
  "5306": [1325, 1455, 1585, 1822, 2062, 2082, 2494, 2864, 3231, 3601, 4033, 4445, 4485, 5377, 6351],
  "5314": [1435, 1675, 1805, 2262, 2612, 2632, 3374, 3964, 4551, 5141, 5793, 6425, 6685, 8127, 9651],
  "5315": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5316": [1435, 1565, 1695, 1932, 2172, 2302, 2714, 3084, 3561, 3931, 4473, 4885, 4925, 5927, 7011],
  "5322": [1402, 1532, 1662, 1899, 2139, 2236, 2758, 3128, 3682, 4052, 4561, 4973, 5013, 6092, 7253],
  "5335": [1435, 1565, 1695, 1932, 2172, 2302, 2714, 3084, 3561, 3931, 4473, 4885, 4925, 5927, 7011],
  "5341": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "5347": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "5355": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2754, 3121, 3491, 3813, 4115, 4265, 5157, 6021],
  "2604": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "92734": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "95214": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "95295": [1402, 1532, 1662, 1899, 2139, 2236, 2758, 3128, 3682, 4052, 4561, 4973, 5013, 6092, 7253],
  "5354": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "1136": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "1137": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3512": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3535": [1446, 1796, 2036, 2493, 2843, 2863, 3715, 4415, 5233, 5933, 6695, 7437, 7697, 9480, 11224],
  "3568": [1315, 1335, 1355, 1372, 1392, 1412, 1494, 1534, 1681, 1771, 1873, 1955, 2035, 2277, 2511],
  "356801": [1315, 1335, 1355, 1372, 1392, 1412, 1494, 1534, 1681, 1771, 1873, 1955, 2035, 2277, 2511],
  "3577": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3582": [1446, 1796, 2036, 2603, 3063, 3083, 3935, 4635, 5453, 6263, 7135, 7877, 8247, 10030, 11994],
  "3622": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3625": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3661": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "3668": [1413, 1763, 2003, 2460, 2920, 3017, 3759, 4459, 5244, 5944, 6783, 7525, 7785, 9535, 11356],
  "3671": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1691, 1731, 1833, 1915, 1955, 2187, 2391],
  "3676": [1523, 1873, 2113, 2680, 3140, 3237, 4199, 5009, 5904, 6714, 7553, 8405, 8775, 10745, 12896],
  "3708": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3715": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3730": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3749": [1446, 1796, 2036, 2493, 2843, 3013, 3715, 4415, 5123, 5933, 6695, 7437, 7697, 9480, 11224],
  "3767": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3787": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3791": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3796": [1523, 1873, 2113, 2680, 3140, 3237, 4199, 5009, 5904, 6714, 7553, 8405, 8775, 10745, 12896],
  "3797": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5034": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5087": [1446, 1796, 1926, 2493, 2953, 2973, 3825, 4525, 5343, 6153, 6915, 7657, 7917, 9700, 11664],
  "5124": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5126": [1523, 1983, 2223, 2900, 3360, 3457, 4529, 5449, 6454, 7374, 8433, 9395, 9765, 11955, 14326],
  "5140": [1446, 1906, 2036, 2713, 3173, 3193, 4265, 5075, 5893, 6813, 7685, 8537, 8907, 11020, 13094],
  "5144": [1446, 1796, 2036, 2603, 3063, 3083, 4045, 4855, 5673, 6483, 7245, 8097, 8467, 10360, 12434],
  "5147": [1325, 1455, 1585, 1822, 2062, 2082, 2494, 2864, 3231, 3601, 4033, 4445, 4485, 5377, 6351],
  "5162": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5170": [1446, 1796, 2036, 2603, 3063, 3083, 4045, 4855, 5673, 6483, 7245, 8097, 8467, 10360, 12434],
  "5182": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5190": [1446, 1796, 1926, 2493, 2953, 3083, 3935, 4745, 5563, 6483, 7135, 7877, 8247, 10030, 11994],
  "5192": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "5213": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5215": [1523, 1873, 2003, 2570, 3030, 3127, 3979, 4679, 5574, 6384, 7223, 7965, 8225, 10085, 12126],
  "5221": [1336, 1686, 1926, 2383, 2843, 2863, 3605, 4305, 5013, 5713, 6475, 7217, 7477, 9150, 10894],
  "5223": [1468, 1851, 2124, 2493, 2986, 3149, 4056, 3885, 4575, 5150, 5640, 6299, 6544, 8152, 9583],
  "5239": [1446, 1906, 2146, 2823, 3283, 3303, 4375, 5295, 6223, 7143, 8125, 9087, 9457, 11570, 13864],
  "5262": [1545, 2038, 2311, 2900, 3393, 3633, 4760, 4809, 5686, 6371, 7158, 8037, 8282, 10297, 12245],
  "5271": [1446, 1796, 2036, 2603, 3063, 3083, 4045, 4855, 5673, 6483, 7245, 8097, 8467, 10360, 12434],
  "5272": [1336, 1686, 1926, 2383, 2843, 2863, 3605, 4305, 5013, 5713, 6475, 7217, 7477, 9150, 10894],
  "5276": [1215, 1285, 1365, 1382, 1402, 1422, 1504, 1544, 1801, 1841, 1943, 2025, 2065, 2297, 2501],
  "5286": [1673, 1763, 2003, 2570, 3180, 3277, 4019, 4719, 5394, 6214, 7163, 7895, 8155, 10015, 11726],
  "5299": [1446, 1906, 2003, 2493, 2953, 2973, 3825, 4525, 5464, 6153, 6915, 7657, 7917, 9700, 11664],
  "5310": [1336, 1686, 1926, 2383, 2843, 2863, 3605, 4305, 5013, 5713, 6475, 7217, 7477, 9150, 10894],
  "5312": [1325, 1455, 1475, 1712, 1842, 1862, 2164, 2424, 2791, 3051, 3373, 3675, 3715, 4497, 5251],
  "5317": [1446, 1796, 2036, 2603, 3063, 3083, 3935, 4745, 5453, 6263, 7135, 7877, 8247, 10030, 11994],
  "5319": [1446, 1796, 2036, 2603, 3063, 3083, 3935, 4745, 5453, 6263, 7135, 7877, 8247, 10030, 11994],
  "5325": [1325, 1455, 1475, 1712, 1842, 1862, 2164, 2424, 2791, 3051, 3373, 3675, 3715, 4497, 5251],
  // "5337": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "5348": [1446, 1796, 2036, 2603, 3063, 3083, 4045, 4855, 5673, 6483, 7245, 8097, 8467, 10360, 12434],
  "5351": [1446, 1906, 2036, 2713, 3173, 3193, 4265, 5075, 5893, 6813, 7685, 8537, 8907, 11020, 13094],
  "5353": [1446, 1796, 2036, 2603, 3063, 3083, 4045, 4855, 5673, 6483, 7245, 8097, 8467, 10360, 12434],
  // "95337": [1402, 1422, 1552, 1679, 1919, 2016, 2208, 2468, 2912, 3172, 3461, 3763, 3803, 4552, 5383],
  "356802": [1215, 1345, 1365, 1385, 1402, 1422, 1504, 1544, 1691, 1721, 1833, 1915, 1955, 2187, 2281],
  "3504": [1215, 1345, 1365, 1385, 1402, 1422, 1504, 1544, 1691, 1721, 1833, 1915, 1955, 2187, 2281],
  "3518": [1315, 1345, 1365, 1385, 1402, 1422, 1504, 1544, 1691, 1721, 1833, 1915, 1955, 2187, 2281],
  "3601": [1215, 1345, 1365, 1385, 1402, 1422, 1504, 1544, 1691, 1721, 1833, 1915, 1955, 2187, 2281],
  "3666": [1380, 1774, 1948, 2350, 2744, 2808, 3539, 4217, 4793, 5482, 6222, 6843, 7191, 8765, 10410],
  "3751": [1347, 1598, 1640, 1998, 2370, 2401, 2956, 3359, 3869, 4382, 4847, 5402, 5585, 6785, 7946],
  "3798": [1380, 1664, 1838, 2130, 2524, 2588, 3319, 3777, 4463, 5042, 5562, 6183, 6421, 7785, 9310],
  "5025": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5137": [1380, 1774, 1948, 2350, 2744, 2808, 3539, 4217, 4793, 5482, 6222, 6843, 7191, 8765, 10410],
  "5229": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5346": [1380, 1664, 1838, 2130, 2524, 2588, 3319, 3777, 4463, 5042, 5562, 6183, 6421, 7785, 9310],
  "5350": [1380, 1664, 1838, 2240, 2634, 2698, 3319, 3887, 4573, 5152, 5782, 6403, 6641, 8105, 9640],
  "1450": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3503": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3546": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "3779": [1215, 1235, 1365, 1382, 1402, 1422, 1504, 1544, 1691, 1721, 1833, 1915, 1955, 2187, 2281],
  "5110": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5132": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5172": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5200": [1215, 1345, 1365, 1382, 1402, 1422, 1504, 1544, 1691, 1731, 1833, 1915, 1955, 2187, 2281],
  "5201": [1215, 1345, 1365, 1382, 1402, 1422, 1504, 1544, 1691, 1731, 1833, 1915, 1955, 2187, 2281],
  "5257": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5280": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "5331": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2516": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2657": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2702": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2718": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2773": [1325, 1565, 1585, 1932, 2282, 2302, 2824, 3194, 3671, 4151, 4583, 5105, 5255, 6367, 7451],
  "2781": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2801": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "2841": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3574": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3588": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3608": [1215, 1345, 1365, 1492, 1622, 1642, 1944, 2094, 2351, 2611, 2823, 3015, 3055, 3617, 4151],
  "3690": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "3717": [1215, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2603, 2795, 2835, 3287, 3711],
  "3739": [1325, 1345, 1475, 1602, 1842, 1862, 2054, 2314, 2681, 2941, 3153, 3455, 3495, 4167, 4921],
  "5115": [1325, 1565, 1695, 1932, 2172, 2192, 2714, 3084, 3561, 3931, 4363, 4885, 4925, 6037, 7121],
  "5127": [1468, 1961, 2344, 2933, 3536, 3699, 4716, 4875, 5675, 6470, 7290, 8169, 8524, 10572, 12553],
  "5158": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5165": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1654, 1801, 1951, 2053, 2245, 2285, 2517, 2831],
  "5203": [1578, 2071, 2454, 3153, 3756, 3919, 5156, 5425, 6335, 7240, 8060, 9049, 9514, 11782, 14093],
  "5210": [1578, 2071, 2344, 3043, 3646, 3809, 4936, 5095, 6005, 6910, 7730, 8609, 8964, 11122, 13323],
  "5211": [1215, 1345, 1365, 1382, 1512, 1532, 1724, 1764, 2021, 2171, 2383, 2465, 2505, 2957, 3271],
  "5225": [1325, 1345, 1365, 1602, 1732, 1752, 1944, 2204, 2461, 2721, 2933, 3235, 3385, 3837, 4481],
  "5233": [1545, 2038, 2311, 2900, 3393, 3633, 4760, 4809, 5686, 6371, 7158, 8037, 8282, 10297, 12245],
  "5270": [1655, 1675, 1695, 1822, 1952, 1972, 2274, 2424, 2681, 2941, 3153, 3345, 3505, 3947, 4481],
  "5326": [1325, 1565, 1695, 1932, 2282, 2302, 2934, 3304, 3891, 4371, 4803, 5325, 5475, 6697, 7891],
  "5344": [1578, 2071, 2344, 3043, 3646, 3809, 4936, 5095, 6005, 6910, 7730, 8609, 8964, 11122, 13323],
  "92218": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  // "3810": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2263, 2352, 2523],
  "3955": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  // "381602": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1915, 1967, 2061],
  "3905": [1491, 1931, 2261, 2921, 3471, 3581, 4571, 5561, 6452, 7442, 8542, 9422, 9972, 12073, 14493],
  "4407": [1260, 1370, 1480, 1700, 1810, 1920, 2140, 2360, 2690, 2910, 3350, 3570, 3680, 4340, 5000],
  "4414": [1260, 1370, 1480, 1700, 1810, 1920, 2140, 2360, 2690, 2910, 3350, 3570, 3680, 4340, 5000],
  "1611": [1325, 1565, 1695, 2042, 2282, 2302, 2824, 3304, 3781, 4261, 4803, 5215, 5575, 6587, 7781],
  "1612": [1325, 1455, 1475, 1712, 1952, 1972, 2384, 2644, 3011, 3381, 3703, 4115, 4265, 4937, 5801],
  // "2745": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1544, 1691, 1731, 1943, 2025, 2165, 2297, 2501],
  "1140": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1544, 1691, 1731, 1943, 2025, 2165, 2297, 2501],
  "3583": [1446, 1796, 2036, 2603, 3063, 3083, 3935, 4745, 5453, 6263, 7135, 7877, 8457, 10030, 11994],
  "1510": [1325, 1455, 1475, 1602, 1732, 1752, 2054, 2314, 2571, 2831, 3153, 3345, 3485, 4057, 4701],
  "1312": [1325, 1345, 1365, 1492, 1622, 1642, 1834, 1984, 2241, 2391, 2713, 2905, 2945, 3397, 3931],
  "5301": [1781, 2361, 2721, 3511, 4091, 4341, 5751, 6911, 8182, 9342, 10452, 11752, 12472, 15713, 18593],
  "1139": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2143, 2462, 2633],
  "1313": [1325, 1345, 1365, 1492, 1512, 1532, 1724, 1874, 2131, 2281, 2383, 2575, 2615, 3067, 3381],
  "5402": [1325, 1565, 1585, 1822, 2062, 2082, 2604, 2974, 3341, 3711, 4143, 4555, 4595, 5597, 6571],
  "5403": [1215, 1235, 1255, 1272, 1292, 1312, 1394, 1434, 1581, 1621, 1723, 1805, 1735, 2077, 2171],
  "5404": [1215, 1235, 1255, 1382, 1402, 1422, 1504, 1544, 1691, 1731, 1943, 2025, 1955, 2297, 2501],
  "5005": [1292, 1312, 1332, 1349, 1369, 1466, 1548, 1588, 1812, 1852, 2031, 2113, 2043, 2462, 2633],
  "5138": [1380, 1774, 1948, 2350, 2744, 2808, 3539, 4107, 4793, 5482, 6222, 6843, 7081, 8655, 10300],
};

// 金額テーブル初期化
let tbody_price = document.querySelector('#price_table tbody');
tbody_price.innerHTML = "";
for (var key in price_table) {
  table_html = `<tr>
  <td>${key}</td>
  `;
  for (var index in price_table[key]) {
    table_html += `<td align = "right">${Math.round(price_table[key][index]/1.1)}</td>`;
  }
  table_html += `</tr>`;
  tbody_price.innerHTML += table_html;
}

function get_postage(supplier_code, weight) {
  if (supplier_code in price_table) {
    price_list = price_table[supplier_code];
    weight_kg = weight; // kgで入力されることになった
    weight_limits = [10, 20, 30, 40, 50, 60, 80, 100, 120, 140, 160, 180, 200, 250, 300];
    postage = '重量計算ができない範囲です（300 kg超）';
    for (weight_index in weight_limits) {
      if (weight_kg <= weight_limits[weight_index]) {
        postage = price_list[weight_index];
        return postage
      }
    }
    return postage
  }
  return "" // "不明な取引先コードです（" + supplier_code + "）"
}

function get_weight(item_type, amount) {
  // 商品名と量から、重さを取得
  if (item_type in weight_table) {
    return weight_table[item_type] * amount;
  } else {
    console.log(`${item_type}の情報がありません`);
  }
  return NaN;
}

function get_yyyymmdd(delimeter) {
  const today = new Date()
  var yyyy = today.getFullYear();
  var mm = ('0' + (today.getMonth() + 1)).slice(-2);
  var dd = ('0' + today.getDate()).slice(-2);
  return (yyyy + delimeter + mm + delimeter + dd);
}

let fileInput = document.getElementById('csv_file');
let message = document.getElementById('message');
let fileReader = new FileReader();

// ファイル変更時イベント
fileInput.onchange = () => {
  message.innerHTML = "読み込み中..."

  let file = fileInput.files[0];
  // CSVファイルかを確認
  if (file.type != 'text/csv') {
    message.innerHTML = "CSVファイルを選択してください。";
    return;
  }
  fileReader.readAsText(file);
};

// ファイル読み込み時
let items = [];
fileReader.onload = () => {
  // ファイル読み込み
  let fileResult = fileReader.result.split(/\r|\n|\r\n/);

  // 先頭行をヘッダとして格納
  let header = fileResult[0].split(',')
  for (var head in header) { // 使いそうな物は変数名らしい名前に置き換える
    if (header[head].match(/^"取引先コード \(得意先\)"$/)) {
      header[head] = "supplier_code"
    } else if (header[head].match(/^納品書番号$/)) {
      header[head] = "delivery_slip_number"
    } else if (header[head].match(/^"品目コード \(品目\)"$/)) {
      header[head] = "item_code"
    } else if (header[head].match(/^納品数$/)) {
      header[head] = "amount"
    } else if (header[head].match(/^"合計重量 \*"$/)) {
      header[head] = "volume"
    } else if (header[head].match(/^"請求用分類 \* \(品目\)"$/)) {
      header[head] = "type_of_charge"
    } else if (header[head].match(/^ケース$/)) {
      header[head] = "case_num"
    } else if (header[head].match(/^"容量 \* \(品目\)"$/)) {
      header[head] = "capacity"
    } else if (header[head].match(/^"入数 \(品目\)"$/)) {
      header[head] = "irisuu_item"
    } else if (header[head].match(/^金額$/)) {
      header[head] = "price"
    } else if (header[head].match(/^税率$/)) {
      header[head] = "tax_rate"
    } else if (header[head].match(/^"取引先コード \(納入先\)"$/)) {
      header[head] = "destination_code"
    } else if (header[head].match(/^"計上日 \*"$/)) {
      header[head] = "accounting_date"
    } else if (header[head].match(/^"日通指定着時間 \*"$/)) {
      header[head] = "nittuu_appoint_destination_time"
    } else if (header[head].match(/^"日通指定着日 \*"$/)) {
      header[head] = "nittuu_appoint_destination_date"
    }
  }
  // 先頭行の削除
  fileResult.shift();

  // CSVから情報を取得
  items = fileResult.map(item => {
    let datas = item.split(',');
    let result = {};
    for (const index in datas) {
      let key = header[index];
      result[key] = datas[index];
    }
    // 返却
    return result;
  });

  // テーブル初期化
  let tbody = document.querySelector('#csv_data_table tbody');
  tbody.innerHTML = "";

  //　CSVの内容を表示
  let tbody_html = "";
  let output_data = "納品日,得意先,納品単価,メーカー伝票番号 *,概算個口数 *,合計重量,保険金額,請求用納品書番号,納入先コード,計上日,日通指定着時間 *,日通指定着日 *\n";
  let data_by_supplier_code = {}

  for (item of items) {
    if (!item.supplier_code) { //空白行は追加しない（主に最後の空行）
      continue;
    }
    if (item.amount < 0) {
      continue;
    }

    // data_by_supplier_code[[item.supplier_code, item.destination_code]]
    // [0]:  weight[kg]
    // [1]:  伝票番号のリスト
    // [2]:  容量が1800である商品のケース数
    // [3]:  容量が720である商品のケース数
    // [4]:  容量が1800でも720でもなく、種別が03食品以外の商品のケース数
    // [5]:  税込合計金額（各行で、税込金額を計算して四捨五入）
    // [6]:  最も遅い計上日
    // [7]:  容量が1800である商品の端数
    // [8]:  容量が720である商品の端数
    // [9]:  (日通指定着時間 *, 日通指定着日 *)のタプルのリスト
    if (!(item.supplier_code + ":" + item.destination_code in data_by_supplier_code)) {
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code] = [0, [], 0, 0, 0.0, 0, "", 0, 0, []];
    }

    data_by_supplier_code[item.supplier_code + ":" + item.destination_code][0] += parseFloat(item.volume);
    
    if (!(data_by_supplier_code[item.supplier_code + ":" + item.destination_code][1].includes(item.delivery_slip_number))){
      // 新規伝票の場合のみ、伝票番号を足す。
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code][1].push(item.delivery_slip_number);
    }
    
    if (parseInt(item.capacity) == 1800) { // 1800mlを品目コード別に集計
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code][2] += Math.floor(parseInt(item.amount) / parseInt(item.irisuu_item))
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code][7] += parseInt(item.amount) % parseInt(item.irisuu_item)
    } else if (parseInt(item.capacity) == 720) { // 720mlを品目コード別に集計
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code][3] += Math.floor(parseInt(item.amount) / parseInt(item.irisuu_item))
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code][8] += parseInt(item.amount) % parseInt(item.irisuu_item)
    } else if (item.type_of_charge != "03食品") {
      data_by_supplier_code[item.supplier_code + ":" + item.destination_code][4] += parseFloat(item.case_num);
    }
    data_by_supplier_code[item.supplier_code + ":" + item.destination_code][5] += Math.round(parseInt(item.price) * (1.0 + parseInt(item.tax_rate) / 100.0));
    
    data_by_supplier_code[item.supplier_code + ":" + item.destination_code][6] = data_by_supplier_code[item.supplier_code + ":" + item.destination_code][6] < item.accounting_date ? item.accounting_date : data_by_supplier_code[item.supplier_code + ":" + item.destination_code][6]
    
    data_by_supplier_code[item.supplier_code + ":" + item.destination_code][9].push([item.nittuu_appoint_destination_date, item.nittuu_appoint_destination_time])

  }

  for (var key in data_by_supplier_code) {
    supplier_code = key.split(":")[0]
    destination_code = key.split(":")[1]
    weight_for_display = Math.round(data_by_supplier_code[key][0]*100)/100;
    last_accounting_date = data_by_supplier_code[key][6]

    postage_display_color = "black"
    if (destination_code != "") {
      postage = get_postage(destination_code, weight_for_display)
      if (postage == "") {  // 納入先が書かれているけど表にない場合には得意先
        postage = get_postage(supplier_code, weight_for_display)
        postage_display_color = "red"
      }
    } else {
      postage = get_postage(supplier_code, weight_for_display)
    }

    if (postage == "") {  // supplier_codeが表に見つからない場合送料は空
      postage_without_tax = ""
      postage_display_color = "black"
    } else {
      postage_without_tax = Math.round(postage/1.1)
    }
    delivery_slip_numbers = data_by_supplier_code[key][1].join(";");
    kokuti_num_1800 = data_by_supplier_code[key][2]
    kokuti_num_720 = data_by_supplier_code[key][3]
    kokuti_num_hasuu = Math.ceil(data_by_supplier_code[key][7] / 6.0 + data_by_supplier_code[key][8] / 12.0) // ケースあぶれ分はまとめてケースを計算。怪しいが仕様。

    kokuti_num = kokuti_num_1800 + kokuti_num_720 + kokuti_num_hasuu + Math.ceil(data_by_supplier_code[key][4])
    insurance_price = Math.ceil(data_by_supplier_code[key][5] / 10000.0);
    delivery_slip_numbers_for_bill = data_by_supplier_code[key][1].sort()[0]

    // 日通の指定日は最も速い物を選ぶ
    for (var i in data_by_supplier_code[key][9]) {
      console.log(data_by_supplier_code[key][9][i]);
    }
    earliest_nittsu_appoing_destination_date_time = data_by_supplier_code[key][9].sort((a, b) => {
      if (a[0] < b[0]){
        return -1;
      }
      if (b[0] < a[0]){
        return 1;
      }
      if (a[1] < b[1]){
        return -1;
      }
      if (b[1] < a[1]){
        return 1;
      }
      return 0;
    })[0]
    nittuu_appoint_destination_time = earliest_nittsu_appoing_destination_date_time[1]
    if (nittuu_appoint_destination_time ==  "なし") {
      nittuu_appoint_destination_time = ""
    }
    nittuu_appoint_destination_date = earliest_nittsu_appoing_destination_date_time[0]

    tbody_html += `<tr>
      <td align="right"><font color="${postage_display_color}">${supplier_code}</font></td>
      <td align="right"><font color="${postage_display_color}">${weight_for_display}</font></td>
      <td align="right"><font color="${postage_display_color}">${postage}</font></td>
      <td align="right"><font color="${postage_display_color}">${postage_without_tax}</font></td>
      <td><font color="${postage_display_color}">${delivery_slip_numbers}</font></td>
      <td align="right"><font color="${postage_display_color}">${destination_code}</font></td>
      <td align="right"><font color="${postage_display_color}">${kokuti_num}</font></td>
      <td align="right"><font color="${postage_display_color}">${last_accounting_date}</font></td>
      <td align="right"><font color="${postage_display_color}">${nittuu_appoint_destination_time}</font></td>
      <td align="right"><font color="${postage_display_color}">${nittuu_appoint_destination_date}</font></td>
    </tr>`
    tbody.innerHTML = tbody_html;
    output_data += `${get_yyyymmdd("-")},${supplier_code},${postage_without_tax},${delivery_slip_numbers},${kokuti_num},${weight_for_display},${insurance_price},${delivery_slip_numbers_for_bill},${destination_code},${last_accounting_date},${nittuu_appoint_destination_time},${nittuu_appoint_destination_date}\n`
  }

  message.innerHTML = items.length + "件のデータを読み込みました。"
  
  // shift-jisに変換
  unicodeArray = Encoding.stringToCode(output_data);
  convert = Encoding.convert(unicodeArray, {to: 'SJIS', from: 'UNICODE'});
  u8a = new Uint8Array(convert);
  // ダウンロード関連
  let bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
  let blob = new Blob([u8a], {'type' : 'text/csv'});
  
  
  let downloadLink = document.createElement('a');
  downloadLink.download = '日通送料_' + get_yyyymmdd("") + '.csv';
  downloadLink.href = URL.createObjectURL(blob);
  downloadLink.dataset.downloadurl = ['text/plain', downloadLink.download, downloadLink.href].join(':');
  downloadLink.click();
}

// ファイル読み取り失敗時
fileReader.onerror = () => {
  items = [];
  message.innerHTML = "ファイル読み取りに失敗しました。"
}
